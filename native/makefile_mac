# Customizable variables: name of controller and api files (both excluding extension)
CONTROLLER=controller1
API=atron

SRC=nativeController.c $(API).c $(CONTROLLER).c
BIN=$(SRC:.c=.o)
JAVAINCLUDE=/System/Library/Frameworks/JavaVM.framework/Versions/CurrentJDK/Headers
CFLAGS=-fPIC -DUSSR -I$(JAVAINCLUDE)
CC=gcc

all: nativeController.jnilib
	cp nativeController.jnilib ../lib/$(CONTROLLER).jnilib
nativeController.h: ../bin/ussr/samples/ATRONNativeController.class
	javah -jni -classpath ../bin -o nativeController.h ussr.samples.ATRONNativeController
nativeController.jnilib: nativeController.h $(BIN)
	gcc -dynamiclib -framework JavaVM -fPIC -o nativeController.jnilib nativeController.o $(CONTROLLER).o $(API).o
clean:
	rm -f .depends nativeController.jnilib nativeController.h $(BIN)
.depends: nativeController.h
	gcc -I$(JAVAINCLUDE) -M $(SRC) > .depends
include .depends
