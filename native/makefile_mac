# OS-specific variables
JAVAINCLUDE=-I/System/Library/Frameworks/JavaVM.framework/Versions/CurrentJDK/Headers
CFLAGS=-fPIC -DUSSR $(JAVAINCLUDE)
LDFLAGS=-dynamiclib -framework JavaVM -fPIC

# General variables
SRC=nativeController.c $(API).c $(CONTROLLER).c
BIN=$(SRC:.c=.o)
CC=gcc

all: nativeController.jnilib
	cp nativeController.jnilib ../lib/lib$(CONTROLLER).jnilib
nativeController.h: ../bin/ussr/samples/atron/ATRONNativeController.class
	javah -jni -classpath ../bin -o nativeController.h ussr.samples.atron.ATRONNativeController
nativeController.jnilib: nativeController.h $(BIN)
	gcc $(LDFLAGS) -o nativeController.jnilib nativeController.o $(CONTROLLER).o $(API).o
clean:
	rm -f .depends nativeController.jnilib nativeController.h $(BIN)
.depends: nativeController.h
	gcc $(JAVAINCLUDE) -M $(SRC) > .depends
include .depends
