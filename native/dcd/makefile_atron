# Project-specific variables
BASEDIR=/Users/ups/eclipse_workspace/ussr
PROJECTFILESC = dcdController.c dcdError.c dcdInterpreter.c roles.c $(BASEDIR)/native/base/main_atron.c navigation.c actions.c 
PROJECTFILESH = dcdBytecode.h dcdConstants.h dcdController.h dcdError.h dcdInterpreter.h dcdTypes.h roles.h
PROJECT = avrdcd

# Generic variables
ATRONDIR=$(BASEDIR)/../atronAvr
PROCESSOR =  atmega128
C	= $(ATRONDIR)/adc/ADCDriver.c  $(ATRONDIR)/connector/ConnectorDriver.c $(ATRONDIR)/encoder/EncoderDriver.c $(ATRONDIR)/io/IOPortDriver.c $(ATRONDIR)/pwm/PWMDriver.c $(ATRONDIR)/rs485/RS485PhysicalLayer.c $(ATRONDIR)/communication/Communication.c $(ATRONDIR)/communication/ByteBuffer.c $(ATRONDIR)/communication/datalink_protocol.c $(ATRONDIR)/ir/IRProtocolPhysicalLayer.c $(ATRONDIR)/tilt/TiltDriver.c $(ATRONDIR)/battery/BatteryDriver.c $(ATRONDIR)/api/API.c $(PROJECTFILESC) 
H	= $(ATRONDIR)/adc/ADCDriver.h  $(ATRONDIR)/connector/ConnectorDriver.h $(ATRONDIR)/encoder/EncoderDriver.h $(ATRONDIR)/io/IOPortDriver.h $(ATRONDIR)/pwm/PWMDriver.h $(ATRONDIR)/rs485/RS485PhysicalLayer.h $(ATRONDIR)/communication/Communication.h $(ATRONDIR)/communication/ByteBuffer.h $(ATRONDIR)/communication/datalink_protocol.h $(ATRONDIR)/ir/IRProtocolPhysicalLayer.h $(ATRONDIR)/tilt/TiltDriver.h $(ATRONDIR)/battery/BatteryDriver.h $(ATRONDIR)/api/API.h $(ATRONDIR)/include/config.h $(PROJECTFILESH) 
PORT = /dev/cu.usbserial-PRPQVMDD
FINALTYPE=bin

# OS-specific variables
CFLAGS=-mmcu=$(PROCESSOR) -g -Wall -Os -D__SOUTH__ -mmcu=$(PROCESSOR) -I$(ATRONDIR) -I$(BASEDIR)/native/include

ERASE = avarice --jtag $(PORT) --part $(PROCESSOR) --erase
PROGRAM = avarice -B 250kHz --jtag $(PORT) --part $(PROCESSOR) --erase --verify --program --file $(PROJECT).$(FINALTYPE)
DEBUG = avarice --jtag $(PORT) --part $(PROCESSOR) --erase --verify --program --file $(PROJECT).$(FINALTYPE) :4242 
VERIFY = avarice --jtag $(PORT) --part $(PROCESSOR) --verify --file $(PROJECT).$(FINALTYPE)
BURNFUSES = avarice --jtag $(PORT) --part $(PROCESSOR) -W ff11ff
READFUSES = avarice --jtag $(PORT) --part $(PROCESSOR) -r

CC = avr-gcc
BIN = $(C:.c=.o)
LD = avr-gcc
LDFLAGS =  -mmcu=$(PROCESSOR)

all: 	$(BIN)
	$(LD) $(BIN) $(LDFLAGS) -o $(PROJECT).elf
	avr-size $(PROJECT).elf
	avr-objcopy -O binary $(PROJECT).elf $(PROJECT).bin

program:
	$(PROGRAM)

clean:
	rm -f $(BASEDIR)/native/*/*.o
